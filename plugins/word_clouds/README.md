# 词云插件 (Word Clouds)

一个功能丰富的词云生成插件，用于真寻Bot，可以生成群聊或个人的聊天词云，支持多种自定义选项和定时发送功能。

## 功能特点

- **多种词云类型**：支持今日、昨日、本周、本月、年度和历史自定义时间段的词云生成
- **个人/群组词云**：可以生成个人或整个群组的聊天词云
- **定时发送**：支持设置定时自动发送群聊词云
- **资源池管理**：使用资源池管理分词器，提高性能和资源利用率
- **自定义外观**：支持多种颜色映射和背景选项
- **停用词过滤**：自动过滤无意义词汇，提高词云质量
- **任务队列**：使用任务队列管理词云生成任务，避免资源竞争

## 安装方法

1. 将本插件文件夹放置在真寻Bot的`plugins`目录下
2. 安装所需依赖：
   ```bash
   pip install -r plugins/word_clouds/requirements.txt
   ```
3. 在Bot配置中启用插件

## 使用命令

### 获取词云

- `今日/昨日/本周/本月/年度词云` - 获取群聊词云
- `我的今日/昨日/本周/本月/年度词云` - 获取自己的发言词云
- `历史词云 [日期]` - 获取某日词云 (例: 历史词云 2023-01-15)
- `历史词云 [开始日期]~[结束日期]` - 获取时间段词云 (例: 历史词云 2023-01-01~2023-01-31)
- `历史词云 [开始时间]~[结束时间]` - 精确时间段 (例: 历史词云 2023-01-15T10:00:00~2023-01-15T18:30:00)
- `今日词云 -g <群号>` - 获取指定群的词云 (仅超级用户)
- `我的今日词云 -g <群号>` - 获取自己在指定群的词云 (仅超级用户)
- `历史词云 2023-01-01~2023-01-31 -g <群号>` - 获取指定群的历史词云 (仅超级用户)

### 定时发送 (需要管理员权限, -g/-all 需要Superuser)

- `定时词云 开启 <时间>` - 设置当前群定时发送 (例: 定时词云 开启 22:00)
- `定时词云 关闭` - 取消当前群定时发送
- `定时词云 状态` - 查看当前群定时状态
- `定时词云 [开启/关闭/状态] -g <群号>` - 操作指定群聊
- `定时词云 [开启/关闭/状态] -all` - 操作所有群聊
- `定时词云 队列` - 查看任务队列状态 (仅超级用户)
- `定时词云 资源` - 查看资源池状态 (仅超级用户)

## 配置选项

插件提供多种配置选项，可以在真寻Bot的配置界面中设置：

| 配置项 | 默认值 | 说明 |
|-------|-------|------|
| WORD_CLOUDS_TEMPLATE | 1 | 词云模板 (1: 图片生成，使用真寻图片 / 其他: 黑底图片) |
| WORD_CLOUDS_MAX_WORDS | 300 | 词云中显示的最大词数 |
| WORD_CLOUDS_MIN_FONT_SIZE | 8 | 最小字体大小 |
| WORD_CLOUDS_MAX_FONT_SIZE | 100 | 最大字体大小 |
| WORD_CLOUDS_WIDTH | 1920 | 词云图片宽度 |
| WORD_CLOUDS_HEIGHT | 1080 | 词云图片高度 |
| WORD_CLOUDS_BACKGROUND_COLOR | None | 背景颜色 ('white'或'black') |
| WORD_CLOUDS_RELATIVE_SCALING | 0.3 | 相对缩放值，降低相对缩放使词云更均匀 |
| WORD_CLOUDS_PREFER_HORIZONTAL | 0.7 | 水平词的比例，降低该值会增加垂直词的比例 |
| WORD_CLOUDS_COLLOCATIONS | True | 是否检测词组 |

## 自定义停用词

插件支持自定义停用词，可以通过以下方式添加：

1. 在 `data/word_cloud/wordcloud_stopwords.txt` 中添加停用词，每行一个
2. 在 `plugins/word_clouds/assets/stopwords.txt` 中添加额外的停用词

## 自定义词典

可以在 `data/word_cloud/wordcloud_userdict.txt` 中添加自定义词典，每行一个词语，用于改善分词效果。

## 资源文件

插件会自动下载所需的资源文件：

- 词云背景图片：保存在 `resources/image/wordcloud/` 目录下
- 字体文件：保存在 `resources/font/` 目录下

## 依赖项

详见 `requirements.txt` 文件。

## 作者

- 作者：yajiwa
- 版本：1.3.0
- 插件类型：功能型插件

## 许可证

本插件遵循与真寻Bot相同的许可证。
